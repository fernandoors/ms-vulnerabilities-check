"use client";

import { useState } from "react";
import { ButtonField } from "@/components/Button/Button";
import { InputRoot, InputTextAreaField } from "@/components/Input/Input";
import { ScanSearch } from "lucide-react";

export const VulnerabilityForm = () => {
    const [jsonContent, setJsonContent] = useState("");
    const handleDrop = (event: React.DragEvent<HTMLTextAreaElement>) => {
        event.preventDefault();

        if (event.dataTransfer.files.length === 0) return;
        const [file] = event.dataTransfer.files;
        if (file.type !== "application/json") {
            alert("Please drop the `package.json` file.");
            return;
        }
        const reader = new FileReader();
        reader.onload = (event) => {
            const content = event?.target?.result as string;
            setJsonContent(content);
        };
        reader.readAsText(file);
    };

    return (
        <div className="flex flex-col gap-4">
            <InputRoot className="min-h-[500px]">
                <InputTextAreaField
                    value={jsonContent}
                    onChange={(event) => setJsonContent(event.target.value)}
                    onDrop={handleDrop}
                    onDragOver={(event) => event.preventDefault()}
                    placeholder="Drag or Paste your package.json file here"
                />
            </InputRoot>

            <ButtonField disabled={!jsonContent}>
                <ScanSearch />
                Scan Vulnerabilities
            </ButtonField>
        </div>
    );
};
